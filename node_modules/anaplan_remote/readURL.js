const fs = require('fs'),
	path = require('path'),
	https = require('https'),
	htmlToJson = require('html-to-json'),
	captureImages = require('./captureImages'),
	printModel = require('./printModel'),
	panelObj = require('./panelObj'),
	printImages = require('./printImages'),
	errHandling = require('./errHandling');

const { URL } = require('url'),
	followHTTPS = require('follow-redirects').https,
	request = require('request');

let readURL = ( url, print ) => {

	let httpRegEx = /^https:\/\//;
	if ( httpRegEx.test( url ) === false ) {
		url = 'https://' + url;
	}

	request({
	    url: url,
	    method: 'GET',
	    followAllRedirects: true,
	    maxRedirects: 10
	}, function(error, response, body) {
	    if (error) {
	        console.log(error);
	    } else {
	        //console.log(response.statusCode);
	        //console.log(response.headers);
	        //console.log(print);
	        let printName = url.replace('https://t.co/', '');
	        //console.log(response.request.uri.host + response.request.uri.pathname);

			fs.writeFile(print + printName + '.json', JSON.stringify(response), (err) => {
				if ( err ) {
					console.log(err);
				}
				console.log('file written');
			});

	        return false;
	    }
	});

};

module.exports = readURL;